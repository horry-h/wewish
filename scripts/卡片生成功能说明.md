# å¡ç‰‡ç”Ÿæˆä¸åˆ†äº«åŠŸèƒ½è¯´æ˜

## æ¦‚è¿°
å®ç°äº†å®Œæ•´çš„æµ·æŠ¥ç”Ÿæˆã€é¢„è§ˆå’Œåˆ†äº«åŠŸèƒ½ï¼Œç”¨æˆ·å¯ä»¥å°†ä¹¦çµçš„è§£è¯»ç”Ÿæˆç²¾ç¾çš„å›¾ç‰‡å¡ç‰‡ï¼Œä¿å­˜åˆ°ç›¸å†Œæˆ–åˆ†äº«ç»™å¥½å‹ã€‚

---

## åŠŸèƒ½ç‰¹æ€§

### 1. ğŸ¨ æµ·æŠ¥ç»˜åˆ¶ï¼ˆCanvas 2Dï¼‰
- **ç”»å¸ƒå°ºå¯¸**: 750px Ã— 1000px (3:4 æ¯”ä¾‹)
- **èƒŒæ™¯è®¾è®¡**: æ·±è“è‰²æ¸å˜ + æ˜Ÿå…‰ç‚¹ç¼€æ•ˆæœ
- **å†…å®¹å¸ƒå±€**:
  - é¡¶éƒ¨ï¼šåˆ†ç±»å›¾æ ‡ + åˆ†ç±»åç§°
  - ä¸­é—´ï¼šæ ¸å¿ƒç­”æ¡ˆï¼ˆå¤§å­—ä½“ + å…‰æ™•æ•ˆæœï¼‰
  - æ­£æ–‡ï¼šAI è§£è¯»ï¼ˆè‡ªåŠ¨æ¢è¡Œï¼Œè¡Œé—´è· 1.5 å€ï¼‰
  - åº•éƒ¨ï¼šæ—¶é—´æˆ³ + å“ç‰Œæ°´å° + å°ç¨‹åºç å ä½ç¬¦

### 2. ğŸ“± é¢„è§ˆå¼¹çª—
- åŠé€æ˜é®ç½© + æ¨¡ç³Šæ•ˆæœ
- æ”¯æŒé•¿æŒ‰ä¿å­˜
- æä¾›"ä¿å­˜åˆ°ç›¸å†Œ"å’Œ"å…³é—­"æŒ‰é’®
- æµç•…çš„è¿›å…¥åŠ¨ç”»

### 3. ğŸ’¾ ä¿å­˜åˆ°ç›¸å†Œ
- æ™ºèƒ½æƒé™æ£€æµ‹
- æ‹’ç»æƒé™æ—¶å¼•å¯¼ç”¨æˆ·æ‰“å¼€è®¾ç½®
- ä¿å­˜æˆåŠŸæç¤º

### 4. ğŸ“¤ åˆ†äº«åŠŸèƒ½
- åˆ†äº«ç»™å¥½å‹ï¼šåŠ¨æ€ç”Ÿæˆåˆ†äº«æ–‡æ¡ˆ
- åˆ†äº«åˆ°æœ‹å‹åœˆï¼šç®€æ´ç‰ˆæ–‡æ¡ˆ
- è‡ªåŠ¨ä½¿ç”¨ç”Ÿæˆçš„æµ·æŠ¥ä½œä¸ºåˆ†äº«å›¾

---

## æŠ€æœ¯å®ç°

### Canvas 2D ç»˜åˆ¶æµç¨‹

```typescript
// 1. è·å– Canvas èŠ‚ç‚¹
const query = wx.createSelectorQuery()
query.select('#posterCanvas')
  .fields({ node: true, size: true })
  .exec((res) => {
    const canvas = res[0].node
    const ctx = canvas.getContext('2d')
    
    // 2. è®¾ç½®é«˜æ¸…æ˜¾ç¤º
    const dpr = wx.getSystemInfoSync().pixelRatio
    canvas.width = 750 * dpr
    canvas.height = 1000 * dpr
    ctx.scale(dpr, dpr)
    
    // 3. ç»˜åˆ¶å†…å®¹...
    
    // 4. å¯¼å‡ºå›¾ç‰‡
    wx.canvasToTempFilePath({
      canvas: canvas,
      success: (res) => {
        // æ˜¾ç¤ºé¢„è§ˆå¼¹çª—
      }
    })
  })
```

### è‡ªåŠ¨æ¢è¡Œç®—æ³•

```typescript
drawMultilineText(ctx, text, x, y, maxWidth, lineHeight) {
  const lines: string[] = []
  let currentLine = ''

  for (let i = 0; i < text.length; i++) {
    const char = text[i]
    const testLine = currentLine + char
    const metrics = ctx.measureText(testLine)

    if (metrics.width > maxWidth && currentLine) {
      lines.push(currentLine)
      currentLine = char
    } else {
      currentLine = testLine
    }
  }
  
  // ç»˜åˆ¶æ‰€æœ‰è¡Œ
  lines.forEach((line, index) => {
    ctx.fillText(line, x, y + index * lineHeight)
  })
}
```

### æƒé™å¤„ç†é€»è¾‘

```typescript
async savePoster() {
  // 1. æ£€æŸ¥æˆæƒçŠ¶æ€
  const authResult = await wx.getSetting()
  
  if (authResult.authSetting['scope.writePhotosAlbum'] === false) {
    // 2. ç”¨æˆ·ä¹‹å‰æ‹’ç»è¿‡ï¼Œå¼•å¯¼æ‰“å¼€è®¾ç½®
    wx.showModal({
      title: 'éœ€è¦ç›¸å†Œæƒé™',
      content: 'è¯·å…è®¸è®¿é—®æ‚¨çš„ç›¸å†Œï¼Œä»¥ä¾¿ä¿å­˜å›¾ç‰‡',
      confirmText: 'å»è®¾ç½®',
      success: (res) => {
        if (res.confirm) {
          wx.openSetting()
        }
      }
    })
    return
  }

  // 3. ä¿å­˜å›¾ç‰‡
  wx.saveImageToPhotosAlbum({
    filePath: this.data.posterImagePath,
    success: () => {
      wx.showToast({ title: 'å·²ä¿å­˜åˆ°ç›¸å†Œ', icon: 'success' })
    }
  })
}
```

---

## æµ·æŠ¥è®¾è®¡è§„èŒƒ

### è§†è§‰å±‚æ¬¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       åˆ†ç±»å›¾æ ‡ ğŸˆ          â”‚  (é¡¶éƒ¨)
â”‚       åˆ†ç±»åç§°              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                             â”‚
â”‚   ã€Œ æ ¸å¿ƒç­”æ¡ˆ ã€           â”‚  (ä¸­é—´ - ä¸»è§†è§‰)
â”‚    (å¤§å­—ä½“ + å…‰æ™•)         â”‚
â”‚                             â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”‚  (è£…é¥°çº¿)
â”‚                             â”‚
â”‚   AI è§£è¯»æ–‡å­—              â”‚  (æ­£æ–‡åŒºåŸŸ)
â”‚   è‡ªåŠ¨æ¢è¡Œ...              â”‚
â”‚   è¡Œé—´è· 1.5 å€            â”‚
â”‚                             â”‚
â”‚                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è®°å½•äº 2026.01.28         â”‚  (åº•éƒ¨)
â”‚  â€”â€” æ¥è‡ªã€Šå¿ƒä¹‹è§£æƒ‘ã€‹ä¹¦çµ   â”‚
â”‚  [å°ç¨‹åºç ] æ‰«ç ä½“éªŒ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é…è‰²æ–¹æ¡ˆ
- **èƒŒæ™¯æ¸å˜**: `#0a1929` â†’ `#1a2f4a` â†’ `#0a1929`
- **ä¸»æ–‡å­—**: `#ffffff` (ä¸é€æ˜åº¦ 90%)
- **æ¬¡è¦æ–‡å­—**: `rgba(255, 255, 255, 0.6)`
- **è£…é¥°å…ƒç´ **: `rgba(255, 255, 255, 0.3)`
- **å…‰æ™•æ•ˆæœ**: `rgba(255, 255, 255, 0.5)` + æ¨¡ç³Š 30px

### å­—ä½“è§„æ ¼
| å…ƒç´  | å­—å· | ç²—ç»† | é¢œè‰² |
|------|------|------|------|
| åˆ†ç±»å›¾æ ‡ | 48px | - | - |
| åˆ†ç±»åç§° | 32px | bold | #ffffff |
| æ ¸å¿ƒç­”æ¡ˆ | 64px | bold | #ffffff + å…‰æ™• |
| æ­£æ–‡è§£è¯» | 24px | normal | rgba(255, 255, 255, 0.9) |
| æ—¶é—´æˆ³ | 20px | normal | rgba(255, 255, 255, 0.6) |
| å“ç‰Œæ°´å° | 18px | normal | rgba(255, 255, 255, 0.4) |
| æç¤ºæ–‡å­— | 16px | normal | rgba(255, 255, 255, 0.5) |

---

## äº¤äº’æµç¨‹

### ç”¨æˆ·æ“ä½œæµç¨‹
```
ç‚¹å‡»"ç”Ÿæˆå¡ç‰‡"
    â†“
æ˜¾ç¤º Loading "ä¹¦çµæ­£åœ¨ç»˜å›¾..."
    â†“
Canvas ç»˜åˆ¶æµ·æŠ¥ (300ms)
    â†“
å¯¼å‡ºä¸´æ—¶å›¾ç‰‡
    â†“
æ˜¾ç¤ºé¢„è§ˆå¼¹çª—
    â†“
ç”¨æˆ·é€‰æ‹©æ“ä½œï¼š
  â”œâ”€ é•¿æŒ‰å›¾ç‰‡ â†’ ç³»ç»Ÿä¿å­˜èœå•
  â”œâ”€ ç‚¹å‡»"ä¿å­˜åˆ°ç›¸å†Œ" â†’ æ£€æŸ¥æƒé™ â†’ ä¿å­˜
  â””â”€ ç‚¹å‡»"å…³é—­" â†’ å…³é—­å¼¹çª—
```

### æƒé™å¤„ç†æµç¨‹
```
ç‚¹å‡»"ä¿å­˜åˆ°ç›¸å†Œ"
    â†“
æ£€æŸ¥æƒé™çŠ¶æ€
    â”œâ”€ æœªæˆæƒ â†’ é¦–æ¬¡è¯·æ±‚æˆæƒ
    â”œâ”€ å·²æ‹’ç» â†’ å¼¹çª—å¼•å¯¼æ‰“å¼€è®¾ç½®
    â””â”€ å·²æˆæƒ â†’ ç›´æ¥ä¿å­˜
        â†“
    ä¿å­˜ç»“æœ
        â”œâ”€ æˆåŠŸ â†’ Toast æç¤º + å…³é—­å¼¹çª—
        â””â”€ å¤±è´¥ â†’ Toast é”™è¯¯æç¤º
```

---

## åˆ†äº«é…ç½®

### åˆ†äº«ç»™å¥½å‹
```typescript
onShareAppMessage() {
  return {
    title: `æˆ‘æŠ½åˆ°äº†ç­”æ¡ˆï¼šã€Œ${this.data.resultAnswer}ã€ï¼Œä½ ä¹Ÿæ¥å¬å¬ä¹¦çµçš„è§£è¯»`,
    path: '/pages/home/home',
    imageUrl: this.data.posterImagePath || ''
  }
}
```

**ç¤ºä¾‹æ–‡æ¡ˆ**:
> æˆ‘æŠ½åˆ°äº†ç­”æ¡ˆï¼šã€Œæ—¶æœºå·²åˆ°ã€ï¼Œä½ ä¹Ÿæ¥å¬å¬ä¹¦çµçš„è§£è¯»

### åˆ†äº«åˆ°æœ‹å‹åœˆ
```typescript
onShareTimeline() {
  return {
    title: `ä¹¦çµè¯´ï¼šã€Œ${this.data.resultAnswer}ã€`,
    query: '',
    imageUrl: this.data.posterImagePath || ''
  }
}
```

**ç¤ºä¾‹æ–‡æ¡ˆ**:
> ä¹¦çµè¯´ï¼šã€Œæ—¶æœºå·²åˆ°ã€

---

## ä»£ç æ–‡ä»¶æ¸…å•

### ä¿®æ”¹çš„æ–‡ä»¶
1. **`home.ts`** (æ–°å¢çº¦ 250 è¡Œä»£ç )
   - æ–°å¢ data å­—æ®µ: `showPosterModal`, `posterImagePath`
   - æ–°å¢æ–¹æ³•: `drawPoster()`, `drawStars()`, `drawMultilineText()`, `savePoster()`, `onClosePosterModal()`
   - ä¿®æ”¹æ–¹æ³•: `onGenerateCard()`, `onShareTap()`
   - æ–°å¢åˆ†äº«é…ç½®: `onShareAppMessage()`, `onShareTimeline()`

2. **`home.wxml`** (æ–°å¢çº¦ 35 è¡Œ)
   - æ–°å¢ç¦»å± Canvas ç»„ä»¶
   - æ–°å¢æµ·æŠ¥é¢„è§ˆå¼¹çª—ç»“æ„

3. **`home.less`** (æ–°å¢çº¦ 120 è¡Œ)
   - æ–°å¢ `.poster-modal` åŠç›¸å…³æ ·å¼
   - å¼¹çª—åŠ¨ç”»ã€æŒ‰é’®æ ·å¼

---

## æ€§èƒ½ä¼˜åŒ–

### Canvas ä¼˜åŒ–
- âœ… ä½¿ç”¨ç¦»å± Canvasï¼ˆ`position: fixed; left: -9999px`ï¼‰
- âœ… è®¾ç½® DPR ç¡®ä¿é«˜æ¸…æ˜¾ç¤º
- âœ… å»¶è¿Ÿ 300ms å¯¼å‡ºï¼Œç¡®ä¿ç»˜åˆ¶å®Œæˆ

### å†…å­˜ç®¡ç†
- âœ… ä¸´æ—¶å›¾ç‰‡è·¯å¾„å­˜å‚¨åœ¨ data ä¸­ï¼Œå¯å¤ç”¨
- âœ… å…³é—­å¼¹çª—ä¸æ¸…é™¤å›¾ç‰‡ï¼Œé¿å…é‡å¤ç”Ÿæˆ
- âš ï¸ æ³¨æ„ï¼šé•¿æ—¶é—´ä½¿ç”¨å¯èƒ½ç§¯ç´¯ä¸´æ—¶æ–‡ä»¶

### æœªæ¥ä¼˜åŒ–å»ºè®®
- [ ] æ·»åŠ ç¼“å­˜æœºåˆ¶ï¼Œç›¸åŒå†…å®¹ä¸é‡å¤ç”Ÿæˆ
- [ ] æ”¯æŒå°ç¨‹åºç åŠ¨æ€ç”Ÿæˆï¼ˆéœ€åç«¯æ”¯æŒï¼‰
- [ ] æ·»åŠ æ›´å¤šæµ·æŠ¥æ¨¡æ¿é€‰æ‹©
- [ ] æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰èƒŒæ™¯

---

## å·²çŸ¥é™åˆ¶

### å°ç¨‹åºç 
å½“å‰ä½¿ç”¨**åœ†å½¢å ä½ç¬¦**ä»£æ›¿çœŸå®å°ç¨‹åºç ï¼ŒåŸå› ï¼š
- å°ç¨‹åºç éœ€è¦åç«¯ API ç”Ÿæˆ
- ç”Ÿæˆéœ€è¦ä¼ å…¥ scene å‚æ•°å’Œ page è·¯å¾„
- éœ€è¦è°ƒç”¨ `wx.getImageInfo` ä¸‹è½½åå†ç»˜åˆ¶

**è§£å†³æ–¹æ¡ˆ**:
```typescript
// 1. åç«¯æä¾›å°ç¨‹åºç ç”Ÿæˆæ¥å£
const qrcodeUrl = await this.generateQRCode()

// 2. ä¸‹è½½å›¾ç‰‡
const imageInfo = await wx.getImageInfo({ src: qrcodeUrl })

// 3. åœ¨ Canvas ä¸­ç»˜åˆ¶
const image = canvas.createImage()
image.src = imageInfo.path
image.onload = () => {
  ctx.drawImage(image, x, y, width, height)
}
```

### æ–‡å­—æº¢å‡º
- å½“å‰å®ç°ä¼šè‡ªåŠ¨æ¢è¡Œï¼Œä½†**ä¸é™åˆ¶æ€»è¡Œæ•°**
- å¦‚æœè§£è¯»æ–‡å­—è¿‡é•¿ï¼ˆ>500 å­—ï¼‰ï¼Œå¯èƒ½è¶…å‡ºç”»å¸ƒ
- å»ºè®®åœ¨ AI Prompt ä¸­ä¸¥æ ¼é™åˆ¶å­—æ•°ï¼ˆ150-250 å­—ï¼‰

### æƒé™å¼•å¯¼
- ç”¨æˆ·æ‹’ç»æƒé™åï¼Œåªèƒ½å¼•å¯¼æ‰“å¼€è®¾ç½®é¡µ
- æ— æ³•ç›´æ¥æ‰“å¼€"ç…§ç‰‡è®¿é—®æƒé™"ï¼Œç”¨æˆ·éœ€è‡ªè¡Œæ‰¾åˆ°å°ç¨‹åºè®¾ç½®

---

## æµ‹è¯•å»ºè®®

### åŠŸèƒ½æµ‹è¯•
- [ ] ç‚¹å‡»"ç”Ÿæˆå¡ç‰‡"ï¼Œæ£€æŸ¥ Loading æ˜¾ç¤º
- [ ] æµ·æŠ¥å†…å®¹æ˜¯å¦å®Œæ•´ï¼ˆåˆ†ç±»ã€ç­”æ¡ˆã€è§£è¯»ã€æ—¶é—´æˆ³ï¼‰
- [ ] é•¿æŒ‰å›¾ç‰‡æ˜¯å¦å¼¹å‡ºç³»ç»Ÿä¿å­˜èœå•
- [ ] ç‚¹å‡»"ä¿å­˜åˆ°ç›¸å†Œ"æ˜¯å¦æˆåŠŸ
- [ ] æ‹’ç»æƒé™åæ˜¯å¦å¼¹å‡ºå¼•å¯¼å¼¹çª—
- [ ] åˆ†äº«ç»™å¥½å‹æ–‡æ¡ˆæ˜¯å¦åŠ¨æ€ç”Ÿæˆ
- [ ] åˆ†äº«åˆ°æœ‹å‹åœˆæ˜¯å¦ä½¿ç”¨æµ·æŠ¥å›¾

### è§†è§‰æµ‹è¯•
- [ ] ä¸åŒæœºå‹ä¸‹ Canvas æ˜¯å¦é«˜æ¸…
- [ ] æ–‡å­—æ˜¯å¦æ­£ç¡®æ¢è¡Œ
- [ ] æ˜Ÿå…‰æ•ˆæœæ˜¯å¦è‡ªç„¶
- [ ] å…‰æ™•æ•ˆæœæ˜¯å¦ç¾è§‚
- [ ] å¼¹çª—åŠ¨ç”»æ˜¯å¦æµç•…

### è¾¹ç•Œæµ‹è¯•
- [ ] è§£è¯»æ–‡å­—ä¸ºç©ºæ—¶
- [ ] è§£è¯»æ–‡å­—ç‰¹åˆ«é•¿æ—¶ï¼ˆ>300 å­—ï¼‰
- [ ] ç”¨æˆ·æœªè¾“å…¥å¿ƒå£°æ—¶
- [ ] åˆ†ç±»ä¸ºé»˜è®¤"æ­¤æ—¶æ­¤åˆ»"æ—¶

---

## æ›´æ–°æ—¥å¿—

- **2026-01-28**: å®Œæ•´å®ç°å¡ç‰‡ç”Ÿæˆã€é¢„è§ˆã€ä¿å­˜å’Œåˆ†äº«åŠŸèƒ½
  - ä½¿ç”¨ Canvas 2D API ç»˜åˆ¶æµ·æŠ¥
  - å®ç°è‡ªåŠ¨æ¢è¡Œç®—æ³•
  - æ™ºèƒ½æƒé™å¤„ç†
  - åŠ¨æ€åˆ†äº«æ–‡æ¡ˆç”Ÿæˆ
