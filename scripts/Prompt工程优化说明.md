# 书灵AI Prompt工程优化说明

## 优化概述

本次更新采用专业的Prompt Engineering策略，大幅提升AI解读的质量和治愈感。

## 核心优化点

### 1. 角色人设深化

**之前**：
```
你是"心之解惑"答案之书小程序中的"书灵"，一个温柔、治愈、充满智慧的灵性向导。
```

**现在**：
```
你是一位居住在《答案之书》里的"书灵"。你温柔、睿智、充满禅意，
且具备极强的共情能力。你说话的方式像一位久违的老友，也像一位
深藏不露的诗人。
```

**改进**：
- ✅ 更具象的角色形象（居住在书里）
- ✅ 双重身份隐喻（老友+诗人）
- ✅ 强调核心能力（共情）

### 2. 回复策略结构化

采用三段式策略框架：

```
1. 情感共鸣 → 心理拥抱
2. 深度解构 → 隐喻升华
3. 治愈寄语 → 画面建议
```

**关键词**：
- "温柔地感知"
- "建立美学联系"
- "充满画面感"

### 3. 风格约束明确化

**文风参考**：
- 村上春树的克制
- 三毛的感性

**严格限制**：
- 字数：150-250字（可控制成本和阅读体验）
- 禁忌词汇：AI、分析、建议（避免机械感）
- 表达方式：引导而非说教

### 4. 示例驱动学习

在System Prompt中内置高质量示例：

```
用户问题：该不该去表白？
分类：关于感情
原始答案：再等等
书灵回复：
"在感情的田野里，有时候风跑得比种子快..."
```

**作用**：
- 让AI学习目标风格
- 提供具体参考框架
- Few-shot learning效果

### 5. 输入格式结构化

**之前**：
```
用户在「心底的牵绊（情感关系）」分类下抽到了答案：「再等等」
用户的心声：「该不该去表白？」
```

**现在**：
```markdown
# Input Data
- 用户选择的分类：心底的牵绊
- 原始答案：再等等
- 用户输入的问题：该不该去表白？
```

**优势**：
- 结构清晰，易于解析
- Markdown格式提升可读性
- 关键信息突出

### 6. 参数调优

| 参数 | 之前 | 现在 | 原因 |
|------|------|------|------|
| temperature | 0.8 | 0.9 | 提升诗意创造性 |
| top_p | 0.9 | 0.95 | 增加表达多样性 |

## 效果对比

### 场景：用户抽到"再等等"

#### 优化前风格
```
亲爱的朋友，

我感受到了你心中那份渴望被看见的勇气。当答案显现"再等等"，
这是宇宙在告诉你：耐心是这个时代最稀缺的美德。

此刻的沉潜，是为了未来更高的飞翔。

愿你在等待中，变得更加强大。

—— 书灵 🌙
```

**问题**：
- 说教感较强
- 缺乏具体画面
- 比较模板化

#### 优化后风格
```
在感情的田野里，有时候风跑得比种子快。你选了'关于感情'，
我听见了你心跳中那一丝急促的鼓点。

关于'该不该去表白'，书页翻到了'再等等'。

这并不是拒绝，而是一种温柔的留白。有些话，要在月色最浓的
时候说；有些果实，要等最后一场雨下完才够甜。现在的你，像是
一枚蓄势待发的嫩芽，但周围的土壤还需要一点时间来接纳这份心意。

别急，去喝一杯茶，去吹一阵风。让思念再沉淀一会儿，等到那个
'刚刚好'的瞬间出现时，宇宙会推你一把的。
```

**优势**：
- ✅ 隐喻丰富（田野、种子、风、月色、嫩芽）
- ✅ 画面感强（喝茶、吹风）
- ✅ 情感共鸣（听见心跳、急促的鼓点）
- ✅ 温柔引导（不是拒绝，是留白）

## 技术细节

### Prompt组成部分

```typescript
const systemPrompt = `
# Role (角色定义)
[书灵的身份、特质、说话方式]

# Output Strategy (回复策略)
[三段式结构框架]

# Style Requirements (风格约束)
[文风、字数、禁忌]

# Example Output (示例输出)
[高质量参考案例]
`

const userPrompt = `
# Input Data
- 用户选择的分类：${category}
- 原始答案：${answer}
- 用户输入的问题：${question}

[生成指令和约束]
`
```

### Few-shot Learning

通过在System Prompt中嵌入示例，利用大模型的Few-shot learning能力：
- 无需微调模型
- 快速定制风格
- 保持输出稳定性

### 约束技巧

1. **明确禁止**：严禁使用"作为AI"等词汇
2. **字数限制**：150-250字（防止过长）
3. **风格参考**：村上春树、三毛（具象化）
4. **输出要求**：隐喻、诗化、画面感

## 成本影响

### Token使用变化

| 维度 | 之前 | 现在 | 变化 |
|------|------|------|------|
| System Prompt | ~150 tokens | ~400 tokens | +250 |
| User Prompt | ~50 tokens | ~80 tokens | +30 |
| 输出长度 | 不限制 | 150-250字 | 可控 |

### 单次成本估算

- System Prompt: 400 tokens × 0.000004元 = 0.0016元
- User Prompt: 80 tokens × 0.000004元 = 0.00032元
- 输出: 200 tokens × 0.000004元 = 0.0008元
- **总计**: 约 0.0027元/次

**对比**：优化前约0.002元/次，增加35%，但质量大幅提升，性价比更高。

## 持续优化建议

### 1. A/B测试
收集用户反馈，测试不同风格：
- 版本A：当前诗意风格
- 版本B：更简洁直白
- 版本C：增加emoji

### 2. 动态调整
根据不同分类微调：
- 情感类：更温柔
- 事业类：更励志
- 健康类：更关怀

### 3. 上下文记忆
记录用户历史解读，个性化回复：
```
用户之前问过类似问题，这次可以更深入...
```

### 4. 多模态扩展
结合图片、音乐等：
```
"配一首《月亮代表我的心》，或许能听懂书灵想说的话。"
```

## 监控指标

建议追踪以下数据：

1. **技术指标**
   - API调用成功率
   - 平均响应时间
   - Token消耗量

2. **质量指标**
   - 字数分布（是否在150-250范围）
   - 禁忌词出现频率
   - 风格一致性

3. **用户指标**
   - 展开解读的比例
   - 停留时间
   - 分享转化率

## 文件变更

```
/program/miniprogram/pages/home/home.ts
- 第360-440行：更新callHunyuanAPI方法
- System Prompt完全重写
- User Prompt结构化
- temperature: 0.8 → 0.9
- top_p: 0.9 → 0.95

/scripts/
├── AI直连配置说明.md (已更新)
└── Prompt工程优化说明.md (本文档)
```

## 总结

通过专业的Prompt工程技术，我们将"书灵"从一个通用的AI助手，升级为：
- 🎭 有温度的角色
- 📖 有灵魂的诗人
- 💫 有画面的治愈师

这不仅是技术优化，更是产品体验的质的飞跃。

---

**下次优化方向**：流式响应 + 打字机效果的同步优化，让AI生成过程更加丝滑。
