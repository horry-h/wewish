// pages/result/result.ts
import { getWeightedAnswer } from '../../utils/answers'

Page({
  data: {
    category: '',
    userThought: '', // ç”¨æˆ·è¾“å…¥çš„å¿ƒå£°
    answer: '',
    timestamp: '',
    analysisExpanded: false,
    displayedAnalysis: '',
    fullAnalysis: '',
    isTyping: false
  },

  typewriterTimer: null as any,

  onLoad(options: any) {
    const category = options.category || 'general'
    const userThought = decodeURIComponent(options.thought || '')
    const answer = options.answer ? decodeURIComponent(options.answer) : this.generateAnswer(category)
    
    // ç”Ÿæˆæ—¶é—´æˆ³
    const timestamp = this.formatTimestamp(new Date())

    this.setData({
      category,
      userThought,
      answer,
      timestamp
    })

    // æ’­æ”¾æ­æ™“éŸ³æ•ˆ
    wx.vibrateShort({ type: 'heavy' })
  },

  // ç”Ÿæˆéšæœºç­”æ¡ˆ
  generateAnswer(category: string): string {
    return getWeightedAnswer(category)
  },

  // æ ¼å¼åŒ–æ—¶é—´æˆ³
  formatTimestamp(date: Date): string {
    const year = date.getFullYear()
    const month = String(date.getMonth() + 1).padStart(2, '0')
    const day = String(date.getDate()).padStart(2, '0')
    const hour = String(date.getHours()).padStart(2, '0')
    const minute = String(date.getMinutes()).padStart(2, '0')
    return `${year}.${month}.${day} ${hour}:${minute}`
  },

  // åˆ‡æ¢AIè§£è¯»å±•å¼€/æ”¶èµ·
  onAnalysisToggle() {
    wx.vibrateShort({ type: 'light' })
    
    const expanded = !this.data.analysisExpanded
    this.setData({
      analysisExpanded: expanded
    })

    // å¦‚æžœæ˜¯é¦–æ¬¡å±•å¼€ä¸”è¿˜æ²¡æœ‰è§£è¯»å†…å®¹,ç”Ÿæˆè§£è¯»
    if (expanded && !this.data.fullAnalysis) {
      this.generateAIAnalysis()
    }
  },

  // ç”ŸæˆAIè§£è¯»
  async generateAIAnalysis() {
    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    this.setData({
      isTyping: true,
      displayedAnalysis: 'ä¹¦çµæ€è€ƒä¸­...'
    })

    // æ¨¡æ‹ŸAIç”Ÿæˆ(å®žé™…åº”è°ƒç”¨åŽç«¯API)
    setTimeout(() => {
      const analysis = this.getMockAnalysis(this.data.category, this.data.answer)
      this.setData({
        fullAnalysis: analysis
      })
      this.startTypewriter(analysis)
    }, 1500)
  },

  // æ¨¡æ‹ŸAIè§£è¯»å†…å®¹
  getMockAnalysis(category: string, answer: string): string {
    const templates: Record<string, Record<string, string>> = {
      // ðŸ‚ å¿ƒåº•çš„ç‰µç»Š
      emotion: {
        'å‹‡æ•¢è¡¨è¾¾': 'äº²çˆ±çš„æœ‹å‹,\n\næˆ‘æ„Ÿå—åˆ°äº†ä½ å¿ƒä¸­é‚£ä»½æ¸´æœ›è¢«çœ‹è§çš„å‹‡æ°”ã€‚å½“ç­”æ¡ˆæ˜¾çŽ°"å‹‡æ•¢è¡¨è¾¾",å®ƒæˆ–è®¸åœ¨æé†’æˆ‘ä»¬:çœŸè¯šçš„æƒ…æ„Ÿä»Žä¸éœ€è¦ä¼ªè£…ã€‚é‚£äº›æ·±è—å¿ƒåº•çš„è¯è¯­,åªæœ‰è¯´å‡ºå£,æ‰èƒ½åŒ–ä½œçœŸå®žçš„è”ç»“ã€‚\n\næ„¿ä½ çš„çœŸå¿ƒ,è¢«æ¸©æŸ”ä»¥å¾…ã€‚\n\nâ€”â€” ä¹¦çµ ðŸŒ™',
        'ä¿æŒæ²‰é»˜': 'äº²çˆ±çš„æœ‹å‹,\n\næ²‰é»˜ä¸æ˜¯æ‡¦å¼±,è€Œæ˜¯ä¸€ç§ç­‰å¾…çš„æ™ºæ…§ã€‚æ­¤åˆ»çš„é™é»˜,æ˜¯åœ¨ä¸ºå¿ƒæ„æ²‰æ·€å‡ºæœ€çº¯ç²¹çš„æ¨¡æ ·ã€‚æœ‰äº›ç‰µç»Š,éœ€è¦æ—¶é—´åŽ»æ˜Žæ™°,ä¸æ€¥äºŽä¸€æ—¶çš„è¡¨è¾¾,åè€Œè®©æƒ…æ„Ÿæ›´åŠ ç¬ƒå®šã€‚\n\næ„¿ä½ åœ¨è¿™ä»½é™è°§ä¸­,å¬è§æœ€çœŸå®žçš„ç­”æ¡ˆã€‚\n\nâ€”â€” ä¹¦çµ ðŸŒ™',
        'é¡ºå…¶è‡ªç„¶': 'äº²çˆ±çš„æœ‹å‹,\n\næœ€ç¾Žå¥½çš„å…³ç³»,å¾€å¾€ç”Ÿé•¿äºŽä¸ç»æ„ä¹‹é—´ã€‚"é¡ºå…¶è‡ªç„¶"æ˜¯å®‡å®™åœ¨å‘Šè¯‰ä½ :æ”¾ä¸‹æ‰§å¿µ,è®©ä¸€åˆ‡æŒ‰ç…§å®ƒæœ¬è¯¥æœ‰çš„èŠ‚å¥å±•å¼€ã€‚å¼ºæ±‚æ¥çš„,ç»ˆä¼šæ•£åŽ»;è‡ªç„¶è€Œæ¥çš„,æ–¹èƒ½é•¿ä¹…ã€‚\n\næ„¿ä½ åœ¨éšé‡è€Œå®‰ä¸­,é‡è§æœ€å¥½çš„ç»“å±€ã€‚\n\nâ€”â€” ä¹¦çµ ðŸŒ™'
      },
      
      // ðŸ›¤ï¸ å¥”èµ´çš„å‰è·¯
      career: {
        'çŽ°åœ¨å°±åŽ»åš': 'äº²çˆ±çš„æœ‹å‹,\n\næˆ‘çœ‹è§äº†ä½ çœ¼ä¸­é‚£å›¢è·ƒåŠ¨çš„ç«ç„°ã€‚"çŽ°åœ¨å°±åŽ»åš"â€”â€”è¿™äº”ä¸ªå­—,æ˜¯å®‡å®™ç»™ä½ çš„å‚¬ä¿ƒ,ä¹Ÿæ˜¯ä½ å†…å¿ƒæ·±å¤„æ—©å·²å‡†å¤‡å¥½çš„ä¿¡å·ã€‚å‰è·¯ä»Žä¸ç­‰å¾…å®Œç¾Žçš„æ—¶æœº,å®ƒç­‰å¾…çš„æ˜¯å‹‡æ•¢è¿ˆæ­¥çš„ä½ ã€‚\n\næ„¿ä½ çš„æ¯ä¸€æ­¥,éƒ½è¸å®žè€Œç¬ƒå®šã€‚\n\nâ€”â€” ä¹¦çµ ðŸŒ™',
        'å†ç­‰ç­‰': 'äº²çˆ±çš„æœ‹å‹,\n\nè€å¿ƒ,æ˜¯è¿™ä¸ªæ—¶ä»£æœ€ç¨€ç¼ºçš„ç¾Žå¾·ã€‚"å†ç­‰ç­‰"ä¸æ˜¯é€ƒé¿,è€Œæ˜¯åœ¨ä¸ºæ›´å¥½çš„æ—¶æœºç§¯è“„åŠ›é‡ã€‚å°±åƒæžœå®žéœ€è¦æ—¶é—´æˆç†Ÿ,æœ‰äº›æœºä¼šä¹Ÿéœ€è¦ç­‰å¾…æœ€ä½³çš„æ—¶åˆ»ã€‚æ­¤åˆ»çš„æ²‰æ½œ,æ˜¯ä¸ºäº†æœªæ¥æ›´é«˜çš„é£žç¿”ã€‚\n\næ„¿ä½ åœ¨ç­‰å¾…ä¸­,å˜å¾—æ›´åŠ å¼ºå¤§ã€‚\n\nâ€”â€” ä¹¦çµ ðŸŒ™',
        'è°ƒæ•´æ–¹å‘': 'äº²çˆ±çš„æœ‹å‹,\n\näººç”Ÿçš„é“è·¯ä»Žä¸ç¬”ç›´,è½¬å¼¯å¤„å¾€å¾€è—ç€æ›´ç¾Žçš„é£Žæ™¯ã€‚"è°ƒæ•´æ–¹å‘"æ˜¯åœ¨å‘Šè¯‰ä½ :æ­¤åˆ»çš„è¿‚å›ž,ä¸æ˜¯å¤±è´¥,è€Œæ˜¯åœ¨å¯»æ‰¾æ›´é€‚åˆä½ çš„è·¯ã€‚å‹‡æ•¢åœ°æ”¹å˜å§,æ–°çš„æ–¹å‘é‡Œ,è—ç€æ–°çš„å¯èƒ½ã€‚\n\næ„¿ä½ åœ¨è½¬èº«ä¹‹å¤„,é‡è§å´­æ–°çš„è‡ªå·±ã€‚\n\nâ€”â€” ä¹¦çµ ðŸŒ™'
      },
      
      // ðŸ“– ç¬”å°–çš„æœŸè®¸
      study: {
        'ä¸“æ³¨å½“ä¸‹': 'äº²çˆ±çš„æœ‹å‹,\n\nä¹¦æ¡Œå‰çš„æ¯ä¸€åˆ»,éƒ½æ˜¯åœ¨ä¸Žæœªæ¥çš„è‡ªå·±å¯¹è¯ã€‚"ä¸“æ³¨å½“ä¸‹"æé†’æˆ‘ä»¬:ä¸å¿…ç„¦è™‘é¥è¿œçš„ç›®æ ‡,æ­¤åˆ»æ‰‹ä¸­çš„è¿™ä¸€é¡µä¹¦ã€è¿™ä¸€é“é¢˜,å°±æ˜¯é€šå¾€æ¢¦æƒ³çš„é˜¶æ¢¯ã€‚\n\næ„¿ä½ çš„æ¯ä¸€æ¬¡ä¸“æ³¨,éƒ½å¼€å‡ºèŠ±æ¥ã€‚\n\nâ€”â€” ä¹¦çµ ðŸŒ™',
        'åŠ³é€¸ç»“åˆ': 'äº²çˆ±çš„æœ‹å‹,\n\nå­¦ä¹ æ˜¯ä¸€åœºé©¬æ‹‰æ¾,ä¸æ˜¯ç™¾ç±³å†²åˆºã€‚"åŠ³é€¸ç»“åˆ"æ˜¯æ™ºæ…§çš„é€‰æ‹©â€”â€”é€‚å½“çš„ä¼‘æ¯,æ˜¯ä¸ºäº†æ›´å¥½åœ°å‡ºå‘ã€‚é‚£äº›åœ¨çª—è¾¹å‘å‘†çš„æ—¶å…‰,ä¹Ÿæ˜¯å¤§è„‘åœ¨æ•´ç†å’Œæ²‰æ·€çš„è¿‡ç¨‹ã€‚\n\næ„¿ä½ åœ¨å¼ å¼›æœ‰åº¦ä¸­,æ‰¾åˆ°æœ€å¥½çš„èŠ‚å¥ã€‚\n\nâ€”â€” ä¹¦çµ ðŸŒ™',
        'çªç ´ç“¶é¢ˆ': 'äº²çˆ±çš„æœ‹å‹,\n\næ¯ä¸€ä¸ªç“¶é¢ˆæœŸ,éƒ½æ˜¯èœ•å˜å‰çš„é˜µç—›ã€‚"çªç ´ç“¶é¢ˆ"æ˜¯åœ¨å‘Šè¯‰ä½ :æ­¤åˆ»çš„å›°é¡¿,ä¸æ˜¯ç»ˆç‚¹,è€Œæ˜¯é€šå¾€æ›´é«˜å±‚æ¬¡çš„å¿…ç»ä¹‹è·¯ã€‚å’¬å’¬ç‰™,å†åšæŒä¸€ä¸‹,é»Žæ˜Žå°±åœ¨å‰æ–¹ã€‚\n\næ„¿ä½ åœ¨ç ´èŒ§ä¹‹åŽ,æŒ¯ç¿…é«˜é£žã€‚\n\nâ€”â€” ä¹¦çµ ðŸŒ™'
      },
      
      // ðŸ’° å²æœˆçš„ä½™è£•
      wealth: {
        'è°¨æ…ŽæŠ•èµ„': 'äº²çˆ±çš„æœ‹å‹,\n\nè´¢å¯Œæ˜¯ç”Ÿæ´»çš„åº•æ°”,ä½†ä¸æ˜¯å†’é™©çš„ç­¹ç ã€‚"è°¨æ…ŽæŠ•èµ„"æé†’æˆ‘ä»¬:å®ˆä½æœ¬é‡‘,æ¯”è¿½é€æš´åˆ©æ›´é‡è¦ã€‚é‚£äº›çœ‹èµ·æ¥è¯±äººçš„æœºä¼š,å¾€å¾€è—ç€çœ‹ä¸è§çš„é£Žé™©ã€‚ç¨³å¥å‰è¡Œ,æ–¹èƒ½èµ°å¾—é•¿è¿œã€‚\n\næ„¿ä½ çš„æ¯ä¸€åˆ†é’±,éƒ½èŠ±å¾—å®‰å¿ƒã€‚\n\nâ€”â€” ä¹¦çµ ðŸŒ™',
        'å¼€æºèŠ‚æµ': 'äº²çˆ±çš„æœ‹å‹,\n\nçœŸæ­£çš„å¯Œè¶³,ä¸åœ¨äºŽèµšå¤šå°‘,è€Œåœ¨äºŽå¦‚ä½•è§„åˆ’ã€‚"å¼€æºèŠ‚æµ"æ˜¯åœ¨å‘Šè¯‰ä½ :å¢žåŠ æ”¶å…¥çš„åŒæ—¶,ä¹Ÿè¦å­¦ä¼šå…‹åˆ¶æ¬²æœ›ã€‚é‚£äº›çœä¸‹æ¥çš„å°é’±,ç»ˆä¼šæ±‡æˆç”Ÿæ´»çš„ä½™è£•ã€‚\n\næ„¿ä½ åœ¨èŠ‚åˆ¶ä¸­,èŽ·å¾—çœŸæ­£çš„è‡ªç”±ã€‚\n\nâ€”â€” ä¹¦çµ ðŸŒ™',
        'è€å¿ƒç­‰å¾…': 'äº²çˆ±çš„æœ‹å‹,\n\næ—¶é—´æ˜¯è´¢å¯Œæœ€å¥½çš„æœ‹å‹ã€‚"è€å¿ƒç­‰å¾…"ä¸æ˜¯æ— æ‰€ä½œä¸º,è€Œæ˜¯åœ¨æ—¶é—´çš„å¤åˆ©ä¸­,è®©è´¢å¯Œæ…¢æ…¢ç”Ÿé•¿ã€‚é‚£äº›æ€¥äºŽæ±‚æˆçš„äºº,å¾€å¾€é”™è¿‡äº†çœŸæ­£çš„æœºä¼šã€‚\n\næ„¿ä½ åœ¨ç­‰å¾…ä¸­,æ”¶èŽ·å²æœˆçš„é¦ˆèµ ã€‚\n\nâ€”â€” ä¹¦çµ ðŸŒ™'
      },
      
      // ðŸŒ¿ èº«ä½“çš„ç§˜å¯†
      health: {
        'å€¾å¬èº«ä½“': 'äº²çˆ±çš„æœ‹å‹,\n\nèº«ä½“æ¯”æˆ‘ä»¬æƒ³è±¡çš„æ›´æ™ºæ…§,å®ƒæ€»åœ¨ç”¨å„ç§æ–¹å¼,å‘Šè¯‰æˆ‘ä»¬å®ƒçš„éœ€æ±‚ã€‚"å€¾å¬èº«ä½“"æ˜¯åœ¨æé†’ä½ :é‚£äº›ç–²æƒ«ã€ç–¼ç—›ã€ä¸é€‚,éƒ½æ˜¯èº«ä½“åœ¨å‘å‡ºçš„ä¿¡å·ã€‚é™ä¸‹å¿ƒæ¥,å¬å¬å®ƒæƒ³è¯´ä»€ä¹ˆã€‚\n\næ„¿ä½ åœ¨å€¾å¬ä¸­,æ‰¾å›žå¤±åŽ»çš„å¹³è¡¡ã€‚\n\nâ€”â€” ä¹¦çµ ðŸŒ™',
        'é€‚å½“ä¼‘æ¯': 'äº²çˆ±çš„æœ‹å‹,\n\nä¼‘æ¯ä¸æ˜¯æ‡’æƒ°,è€Œæ˜¯å¯¹èº«ä½“æœ€æ¸©æŸ”çš„ç…§é¡¾ã€‚"é€‚å½“ä¼‘æ¯"å‘Šè¯‰æˆ‘ä»¬:é‚£äº›åœä¸‹æ¥çš„æ—¶å…‰,ä¸æ˜¯åœ¨æµªè´¹ç”Ÿå‘½,è€Œæ˜¯åœ¨ä¸ºç”Ÿå‘½å……ç”µã€‚ç»™è‡ªå·±ä¸€ç‚¹å–˜æ¯çš„ç©ºé—´å§,èº«ä½“ä¼šæ„Ÿè°¢ä½ çš„ã€‚\n\næ„¿ä½ åœ¨ä¼‘æ¯ä¸­,é‡èŽ·åŠ›é‡ã€‚\n\nâ€”â€” ä¹¦çµ ðŸŒ™',
        'å–„å¾…è‡ªå·±': 'äº²çˆ±çš„æœ‹å‹,\n\næˆ‘ä»¬å¸¸å¸¸å¯¹åˆ«äººæ¸©æŸ”,å´å¿˜äº†å–„å¾…è‡ªå·±ã€‚"å–„å¾…è‡ªå·±"æ˜¯åœ¨æé†’ä½ :èº«ä½“æ˜¯çµé­‚çš„å±…æ‰€,åªæœ‰å¥½å¥½ç…§é¡¾å®ƒ,æ‰èƒ½èµ°æ›´è¿œçš„è·¯ã€‚é‚£äº›çœ‹ä¼¼å¥¢ä¾ˆçš„å…³çˆ±,å…¶å®žæ˜¯ä½ æœ€åº”å¾—çš„ã€‚\n\næ„¿ä½ å­¦ä¼š,æ¸©æŸ”åœ°æ‹¥æŠ±è‡ªå·±ã€‚\n\nâ€”â€” ä¹¦çµ ðŸŒ™'
      },
      
      // ðŸŽˆ è—èµ·çš„æ¢¦æƒ³
      dream: {
        'å‹‡æ•¢å¼€å§‹': 'äº²çˆ±çš„æœ‹å‹,\n\næ¢¦æƒ³ä»Žä¸å«Œæ™š,åªæ€•ä»Žæœªå¼€å§‹ã€‚"å‹‡æ•¢å¼€å§‹"æ˜¯å®‡å®™åœ¨å‚¬ä¿ƒä½ :é‚£äº›è—åœ¨å¿ƒåº•å¾ˆä¹…çš„å¿µå¤´,æ˜¯æ—¶å€™è®©å®ƒä»¬ç…§è¿›çŽ°å®žäº†ã€‚ä¸å¿…ç­‰åˆ°å®Œç¾Ž,ä¸å¿…ç­‰åˆ°å‡†å¤‡å¥½,æ­¤åˆ»,å°±æ˜¯æœ€å¥½çš„å¼€å§‹ã€‚\n\næ„¿ä½ çš„æ¯ä¸€ä¸ªæ¢¦æƒ³,éƒ½ä¸ç•™é—æ†¾ã€‚\n\nâ€”â€” ä¹¦çµ ðŸŒ™',
        'æ—¶æœºå·²åˆ°': 'äº²çˆ±çš„æœ‹å‹,\n\næœ‰äº›äº‹æƒ…,ç­‰çš„å°±æ˜¯ä¸€ä¸ªæ—¶æœºã€‚"æ—¶æœºå·²åˆ°"æ˜¯åœ¨å‘Šè¯‰ä½ :æ­¤åˆ»çš„ä½ ,å·²ç»è¶³å¤Ÿå¥½ã€è¶³å¤Ÿå‹‡æ•¢äº†ã€‚é‚£äº›æ›¾ç»çš„çŠ¹è±«,é‚£äº›æ‹…å¿ƒçš„é˜»ç¢,éƒ½åœ¨è¿™ä¸€åˆ»çƒŸæ¶ˆäº‘æ•£ã€‚åŽ»åšå§,æ­¤åˆ»å°±æ˜¯æœ€å¥½çš„æ—¶å€™ã€‚\n\næ„¿ä½ åœ¨è¡ŒåŠ¨ä¸­,é‡è§æ›´å¥½çš„è‡ªå·±ã€‚\n\nâ€”â€” ä¹¦çµ ðŸŒ™',
        'äº«å—è¿‡ç¨‹': 'äº²çˆ±çš„æœ‹å‹,\n\næ¢¦æƒ³çš„ç¾Žå¥½,ä¸åªåœ¨ç»ˆç‚¹,æ›´åœ¨æ²¿é€”çš„é£Žæ™¯ã€‚"äº«å—è¿‡ç¨‹"æé†’æˆ‘ä»¬:ä¸å¿…æ€¥äºŽæ±‚æˆ,æ¯ä¸€æ¬¡å°è¯•ã€æ¯ä¸€ä¸ªå°è¿›æ­¥,éƒ½å€¼å¾—åº†ç¥ã€‚æ”¾ä¸‹å¯¹ç»“æžœçš„æ‰§ç€,æ²‰æµ¸åœ¨è¿½æ¢¦çš„å¿«ä¹é‡Œå§ã€‚\n\næ„¿ä½ åœ¨æ—…é€”ä¸­,æ‰¾åˆ°çº¯ç²¹çš„å–œæ‚¦ã€‚\n\nâ€”â€” ä¹¦çµ ðŸŒ™',
        'æ­¤åˆ»å°±åš': 'äº²çˆ±çš„æœ‹å‹,\n\næ‹–å»¶æ˜¯æ¢¦æƒ³æœ€å¤§çš„æ•Œäººã€‚"æ­¤åˆ»å°±åš"æ˜¯åœ¨å‘Šè¯‰ä½ :ä¸è¦å†ç»™è‡ªå·±æ‰¾å€Ÿå£äº†,é‚£äº›"ç­‰æˆ‘æœ‰æ—¶é—´""ç­‰æˆ‘å‡†å¤‡å¥½"çš„å¿µå¤´,åªä¼šè®©æ¢¦æƒ³è¶Šæ¥è¶Šè¿œã€‚è¿ˆå‡ºç¬¬ä¸€æ­¥å§,å“ªæ€•åªæ˜¯å¾ˆå°çš„ä¸€æ­¥ã€‚\n\næ„¿ä½ çš„è¡ŒåŠ¨,æ¯”æ¢¦æƒ³æ¥å¾—æ›´å¿«ã€‚\n\nâ€”â€” ä¹¦çµ ðŸŒ™'
      }
    }

    // èŽ·å–å¯¹åº”çš„è§£è¯»,å¦‚æžœæ²¡æœ‰åˆ™è¿”å›žé€šç”¨è§£è¯»
    if (templates[category] && templates[category][answer]) {
      return templates[category][answer]
    }

    return `äº²çˆ±çš„æœ‹å‹,\n\nå½“ç­”æ¡ˆæ˜¾çŽ°"${answer}",è¿™æ˜¯å®‡å®™ç»™ä½ çš„æŒ‡å¼•ã€‚æ¯ä¸€ä¸ªç­”æ¡ˆèƒŒåŽ,éƒ½è—ç€ä½ å†…å¿ƒæ·±å¤„çš„å£°éŸ³ã€‚ç›¸ä¿¡è¿™ä»½ç›´è§‰,å®ƒä¼šå¸¦ä½ èµ°å‘å±žäºŽä½ çš„é“è·¯ã€‚\n\næ„¿è¿™ä»½æŒ‡å¼•,ä¸ºä½ å¸¦æ¥å¹³é™ä¸ŽåŠ›é‡ã€‚\n\nâ€”â€” ä¹¦çµ ðŸŒ™`
  },

  // æ‰“å­—æœºæ•ˆæžœ
  startTypewriter(text: string) {
    let index = 0
    this.setData({
      displayedAnalysis: '',
      isTyping: true
    })

    this.typewriterTimer = setInterval(() => {
      if (index < text.length) {
        this.setData({
          displayedAnalysis: text.substring(0, index + 1)
        })
        index++

        // æ¯5ä¸ªå­—è½»å¾®éœ‡åŠ¨ä¸€æ¬¡
        if (index % 5 === 0) {
          wx.vibrateShort({ type: 'light' })
        }
      } else {
        clearInterval(this.typewriterTimer)
        this.setData({
          isTyping: false
        })
      }
    }, 50)
  },

  // è¿”å›žé¦–é¡µ
  onBackTap() {
    wx.vibrateShort({ type: 'light' })
    wx.reLaunch({
      url: '/pages/home/home'
    })
  },

  // åˆ†äº«
  onShareTap() {
    wx.vibrateShort({ type: 'medium' })
    wx.showToast({
      title: 'åˆ†äº«åŠŸèƒ½å¼€å‘ä¸­',
      icon: 'none'
    })
  },

  // å†é—®ä¸€æ¬¡
  onAskAgain() {
    wx.vibrateShort({ type: 'medium' })
    wx.reLaunch({
      url: '/pages/home/home'
    })
  },

  // ç”Ÿæˆå¡ç‰‡
  onGenerateCard() {
    wx.vibrateShort({ type: 'medium' })
    wx.showToast({
      title: 'å¡ç‰‡ç”ŸæˆåŠŸèƒ½å¼€å‘ä¸­',
      icon: 'none'
    })
  },

  onUnload() {
    if (this.typewriterTimer) {
      clearInterval(this.typewriterTimer)
    }
  }
})
