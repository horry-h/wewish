<!--pages/home/home.wxml-->
<view class="home-container">
  <!-- çŠ¶æ€æ å ä½ -->
  <view class="status-bar" style="height: {{statusBarHeight}}px;"></view>

  <!-- é¡¶éƒ¨åŒºåŸŸ -->
  <view class="top-area">
    <!-- å·¦ä¾§æ ‡é¢˜ -->
    <view class="header">
      <view class="title gradient-text">å¿ƒä¹‹è§£æƒ‘</view>
      <view class="subtitle">Answer Book</view>
    </view>

    <!-- å³ä¾§æ¯æ—¥ä¸€ç­¾æŒ‰é’® -->
    <view class="daily-btn" bindtap="onDailyCardTap">
      <view class="lantern-icon">ğŸ®</view>
    </view>
  </view>

  <!-- é—®é¢˜åˆ†ç±»åŒº(ç´§å‡‘æ¨ªå‘) -->
  <view class="category-section">
    <view class="category-hint">è¯·é€‰æ‹©é—®é¢˜ç±»å‹</view>
    <view class="category-list-compact">
      <view 
        class="category-chip {{selectedCategory === item.key ? 'active' : ''}}"
        wx:for="{{categories}}"
        wx:key="key"
        bindtap="onCategoryTap"
        data-key="{{item.key}}"
      >
        <text class="chip-icon">{{item.icon}}</text>
        <text class="chip-name">{{item.name}}</text>
      </view>
    </view>
  </view>

  <!-- å¿ƒå£°è¾“å…¥åŒº -->
  <view class="input-section">
    <textarea 
      class="heart-input"
      placeholder="è¯´å‡ºä½ çš„å¿ƒå£°..."
      placeholder-class="input-placeholder"
      maxlength="100"
      value="{{userThought}}"
      bindinput="onInputChange"
    />
    <view class="input-counter">{{userThought.length}}/100</view>
  </view>

  <!-- æ ¸å¿ƒäº¤äº’æŒ‰é’® -->
  <view class="action-section">
    <view 
      class="main-button {{isBreathing ? 'breathing' : ''}} {{isPressing ? 'pressing' : ''}}"
      bindtouchstart="onTouchStart"
      bindtouchend="onTouchEnd"
      bindtouchcancel="onTouchCancel"
    >
      <!-- ç¿»ä¹¦æ•ˆæœå±‚ -->
      <view class="book-pages" wx:if="{{isPressing}}">
        <view 
          class="book-page page-{{index}} {{currentPage === index ? 'active' : ''}}"
          wx:for="{{visiblePages}}"
          wx:key="index"
        ></view>
      </view>

      <!-- æŒ‰é’®å†…å®¹ -->
      <view class="button-content">
        <view class="crystal-icon">ğŸ”®</view>
        <view class="button-text-top">é—­ç›®é»˜å¿µ</view>
        <view class="button-text-bottom" wx:if="{{!isPressing}}">é•¿æŒ‰å¯»å£°</view>
        <view class="zen-quote" wx:if="{{isPressing}}">{{currentZenQuote}}</view>
      </view>
      <view class="ripple"></view>
    </view>
  </view>

  <!-- åº•éƒ¨æ–‡æ¡ˆ -->
  <view class="footer-text">å†…å¿ƒå·²æœ‰ç­”æ¡ˆ,åªéœ€è†å¬</view>

  <!-- ç»“æœå¡ç‰‡å¼¹çª— -->
  <view class="result-modal" wx:if="{{showResultCard}}">
    <view class="result-card">
      <!-- é¡¶éƒ¨æ“ä½œæ  -->
      <view class="card-top-bar">
        <view class="card-back-btn" bindtap="onCloseResultCard">
          <text class="icon">â†</text>
          <text>è¿”å›</text>
        </view>
      </view>

      <!-- è£…é¥°æ˜Ÿæ˜Ÿ -->
      <view class="card-star card-star-1">ğŸŒŸ</view>
      <view class="card-star card-star-2">âœ¨</view>

      <!-- æ ¸å¿ƒç­”æ¡ˆåŒº -->
      <view class="card-answer-section">
        <view class="card-answer">
          <view class="card-answer-text gradient-text">ã€Œ {{resultAnswer}} ã€</view>
        </view>
      </view>

      <!-- åˆ†éš”çº¿ -->
      <view class="card-divider">
        <view class="card-divider-line"></view>
      </view>

      <!-- ç”¨æˆ·å¿ƒå£° -->
      <view class="card-thought-section" wx:if="{{userThought}}">
        <view class="card-thought-label">ä½ çš„å¿ƒå£°</view>
        <view class="card-thought-content">{{userThought}}</view>
      </view>

      <!-- AIè§£è¯»åŒº -->
      <view class="card-analysis-section">
        <view class="card-analysis-header" bindtap="onAnalysisToggle">
          <view class="card-analysis-icon">{{analysisExpanded ? 'ğŸ”¥' : 'ğŸ’¬'}}</view>
          <view class="card-analysis-title">ä¹¦çµè§£è¯»</view>
          <view class="card-analysis-arrow">{{analysisExpanded ? 'â–²' : 'â–¼'}}</view>
        </view>

        <view class="card-analysis-content {{analysisExpanded ? 'expanded' : ''}}">
          <view class="card-analysis-text">{{displayedAnalysis}}</view>
          <view class="cursor {{isTyping ? 'blinking' : ''}}"></view>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’®ç»„ -->
      <view class="card-action-buttons">
        <view class="card-action-btn card-btn-secondary" bindtap="onAskAgain">
          <text>å†é—®ä¸€æ¬¡</text>
        </view>
        <view class="card-action-btn card-btn-primary" bindtap="onGenerateCard">
          <text>ç”Ÿæˆå¡ç‰‡</text>
        </view>
      </view>

      <!-- æ—¶é—´æˆ³ -->
      <view class="card-timestamp">è®°å½•äº {{resultTimestamp}}</view>
    </view>
  </view>

  <!-- ç¦»å±Canvasï¼ˆç”¨äºç”Ÿæˆæµ·æŠ¥ï¼‰ -->
  <canvas 
    type="2d" 
    id="posterCanvas" 
    style="position: fixed; left: -9999px; top: -9999px; width: 750px; height: 1000px;"
  ></canvas>

  <!-- æµ·æŠ¥é¢„è§ˆå¼¹çª— -->
  <view class="poster-modal" wx:if="{{showPosterModal}}">
    <view class="poster-mask" bindtap="onClosePosterModal"></view>
    <view class="poster-content">
      <view class="poster-header">
        <text class="poster-title">é•¿æŒ‰ä¿å­˜å›¾ç‰‡</text>
        <view class="poster-header-right">
          <view 
            class="poster-refresh-btn {{isRefreshingBg ? 'refreshing' : ''}}" 
            bindtap="onRefreshBackground"
          >
            <text class="refresh-icon">ğŸ”„</text>
            <text class="refresh-text">æ¢èƒŒæ™¯</text>
          </view>
          <text class="poster-close" bindtap="onClosePosterModal">âœ•</text>
        </view>
      </view>
      
      <image 
        class="poster-image" 
        src="{{posterImagePath}}" 
        mode="widthFix"
        show-menu-by-longpress
      />
      
      <view class="poster-actions">
        <button class="poster-btn poster-btn-save" bindtap="savePoster">
          ä¿å­˜åˆ°ç›¸å†Œ
        </button>
        <button 
          class="poster-btn poster-btn-share" 
          open-type="share"
        >
          åˆ†äº«
        </button>
      </view>
    </view>
  </view>
</view>
